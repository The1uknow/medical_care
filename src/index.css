@tailwind base;
@tailwind components;
@tailwind utilities;

/* =====================  BASE  ===================== */
@layer base {
  :root {
    /* -------- Core Palette -------- */
    --background: 200 60% 98%;
    --foreground: 220 15% 15%;

    --card: 0 0% 100%;
    --card-foreground: 220 15% 15%;

    --popover: 0 0% 100%;
    --popover-foreground: 220 15% 15%;

    --primary: 200 90% 50%;
    --primary-foreground: 0 0% 100%;

    --secondary: 195 85% 95%;
    --secondary-foreground: 195 85% 35%;

    --muted: 210 40% 96%;
    --muted-foreground: 215 16% 47%;

    --accent: 200 80% 94%;
    --accent-foreground: 195 85% 35%;

    --destructive: 0 84% 60%;
    --destructive-foreground: 0 0% 98%;

    --border: 210 40% 90%;
    --input: 210 40% 90%;
    --ring: 200 90% 50%;

    --radius: 1rem;

    /* -------- Effects -------- */
    --shadow-soft: 0 8px 24px -10px hsl(200 90% 40% / 0.12);
    --shadow-card: 0 4px 16px -6px hsl(200 90% 40% / 0.08);

    /* -------- Gradients -------- */
    --gradient-hero: linear-gradient(135deg, hsl(200 85% 50%) 0%, hsl(200 70% 60%) 100%);
    --gradient-card: linear-gradient(to bottom, hsl(0 0% 100%) 0%, hsl(200 80% 98%) 100%);
  }

  /* -------- Dark Mode -------- */
  .dark {
    --background: 215 25% 12%;
    --foreground: 0 0% 98%;

    --card: 215 25% 15%;
    --card-foreground: 0 0% 98%;

    --popover: 215 25% 15%;
    --popover-foreground: 0 0% 98%;

    --primary: 195 85% 55%;
    --primary-foreground: 0 0% 100%;

    --secondary: 215 25% 20%;
    --secondary-foreground: 0 0% 98%;

    --muted: 215 25% 20%;
    --muted-foreground: 215 20% 65%;

    --accent: 215 25% 22%;
    --accent-foreground: 195 85% 55%;

    --border: 215 25% 20%;
    --input: 215 25% 20%;
    --ring: 195 85% 55%;
  }

  /* -------- Base Styles -------- */
  * { @apply border-border; }

  body {
    @apply text-[hsl(var(--foreground))] font-sans antialiased;
    background: linear-gradient(135deg, hsl(200 60% 98%) 0%, hsl(210 60% 96%) 100%);
  }

  h1, h2, h3, h4, h5 { @apply font-semibold tracking-tight text-[hsl(var(--foreground))]; }

  img { @apply select-none rounded-2xl shadow-card; }

  ::selection { background: hsl(200 90% 50% / .18); }
}


/* =====================  COMPONENTS  ===================== */
@layer components {
  /* ---- Buttons ---- */
  .btn-primary {
    @apply bg-[hsl(var(--primary))] text-white px-6 py-3 rounded-xl font-medium
           shadow-soft transition-all hover:shadow-lg hover:bg-[hsl(200_90%_45%)];
  }

  .btn-outline {
    @apply border border-[hsl(var(--border))] text-[hsl(var(--primary))]
           px-6 py-3 rounded-xl font-medium bg-white/70 backdrop-blur-sm
           transition-all hover:bg-[hsl(var(--accent))]/60 hover:shadow-soft;
  }

  /* ---- Cards ---- */
  .card {
    @apply bg-white/60 backdrop-blur-md border border-[hsl(var(--border))]
           rounded-2xl shadow-card transition-all
           hover:-translate-y-1 hover:shadow-soft;
  }

  .eyebrow {
    @apply inline-block px-4 py-1.5 bg-[hsl(var(--accent))] text-[hsl(200_85%_35%)]
           rounded-full text-sm font-medium mb-6 shadow-sm;
  }

  /* ---- Hero container (для фоновых слоёв) ---- */
  .hero {
    position: relative;
    overflow: visible;
    --hero-overlap: 96px;
  }

  /* Фото на всю ширину */
  .hero::before {
    content: "";
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    width: 100vw;
    top: calc(var(--hero-overlap) * -1);
    bottom: 0;
    background-image: var(--hero-full-bg-image);
    background-size: cover;
    background-position: center 45%;
    opacity: var(--hero-image-opacity, .25);
    z-index: 0;
    pointer-events: none;
  }

  /* Голубая вуаль поверх фото */
  .hero::after {
    content: "";
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    width: 100vw;
    top: calc(var(--hero-overlap) * -1);
    bottom: 0;
    background:
      radial-gradient(900px 520px at 20% 20%, hsl(200 80% 96% / .30), transparent 60%),
      linear-gradient(135deg, hsl(205 70% 98% / .20), hsl(200 60% 99% / .20));
    z-index: 0;
    pointer-events: none;
  }

  /* ---- Catalog section bg ---- */
  .catalog::before {
    content: "";
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    width: 100vw;
    top: calc(var(--catalog-overlap) * -1);
    bottom: 0;
    background-image: var(--catalog-full-bg-image);
    background-size: cover;
    background-position: center 45%;
    opacity: var(--catalog-image-opacity, .45);
    z-index: 0;
    pointer-events: none;
  }

  /* Обёртка под стеклянные панели */
  .hero-scene { position: relative; }

  /* Контент в hero над фоном */
  .hero > * { position: relative; z-index: 1; }

  /* ---- NAV — жидкое стекло ---- */
  .nav-glass {
    position: relative;
    overflow: hidden;
    background: transparent;
    border: 1px solid hsl(0 0% 100% / .4);
    border-radius: 1.25rem;
    box-shadow:
      0 10px 24px -12px hsl(200 90% 40% / .14),
      inset 0 1px 0 hsl(0 0% 100% / .45);
    transition: background .25s ease, border-color .25s ease, box-shadow .25s ease;
  }

  .nav-glass::after {
    content: "";
    position: absolute;
    inset: 0;
    background: linear-gradient(to bottom, hsl(0 0% 100% / .16), transparent 60%);
    pointer-events: none;
  }

  .nav-glass--scrolled {
    background: hsl(0 0% 100% / .18);
    border-color: hsl(0 0% 100% / .55);
    box-shadow:
      0 14px 38px -10px hsl(200 90% 30% / .22),
      inset 0 1px 0 hsl(0 0% 100% / .38);
  }

  /* ---- Стеклянная панель ---- */
  .glass-panel {
    position: relative;
    overflow: hidden;
    background: hsl(0 0% 100% / .1);
    border: 1px solid hsl(0 0% 100% / .60);
    backdrop-filter: saturate(170%) blur(14px);
    -webkit-backdrop-filter: saturate(170%) blur(14px);
    border-radius: 1.25rem;
    box-shadow:
      0 14px 32px -12px hsl(200 90% 40% / .16),
      0 -14px 32px -12px hsla(200,90%,40%,.18),
      12px 0 24px -16px hsl(200 90% 40% / .10),
      -12px 0 24px -16px hsl(200 90% 40% / .10),
      inset 0 1px 0 hsl(0 0% 100% / .35);
  }

  /* Фон панели */
  .glass-panel::before {
    content: "";
    position: absolute;
    inset: 0;
    background-image: var(--panel-bg-image);
    background-size: cover;
    background-position: center;
    opacity: .15;
    z-index: 0;
    pointer-events: none;
  }

  /* Контент панели выше псевдофона */
  .glass-panel > * { position: relative; z-index: 1; }

  /* Карточки поверх стекла (KPI) */
  .glass-card {
    background: hsl(0 0% 100% / .70);
    border: 1px solid hsl(var(--border) / .9);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border-radius: 1rem;
    box-shadow: 0 6px 20px -12px hsl(200 90% 40% / .12);
    isolation: isolate;
  }

  /* фолбэк без blur для nav */
  @supports not ((backdrop-filter: blur(1px)) or (-webkit-backdrop-filter: blur(1px))) {
    .nav-glass { background: hsl(0 0% 100% / .7); }
  }
}


/* ---- Fallback без blur для панелей/карточек ---- */
@supports not ((backdrop-filter: blur(1px)) or (-webkit-backdrop-filter: blur(1px))) {
  .glass-panel { background: hsl(0 0% 100% / .88); }
  .glass-card  { background: hsl(0 0% 100% / .92); }
}


/* =====================  UTILITIES  ===================== */
@layer utilities {
  /* независимые стек-слои */
  .isolate { isolation: isolate; }

  /* быстрые уровни для контента */
  .z-content { position: relative; z-index: 2; }
  .z-decor   { position: relative; z-index: 1; }

  /* у стеклянных панелей псевдофон гарантированно ниже */
  .glass-panel::before { z-index: 0; }
  .glass-panel > *     { position: relative; z-index: 1; }

  /* карточки тоже изолируем */
  .glass-card { isolation: isolate; }

  .bg-blur {
    background: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
  }

  .page-gutter { margin-inline: .5rem; }
  @media (min-width:768px){ .page-gutter{ margin-inline: 1rem; } }

  .scroll-smooth { scroll-behavior: smooth; }
}


/* =====================  MOBILE TWEAKS  ===================== */
@media (max-width: 768px) {
  .nav-glass { border-radius: 14px; }

  .glass-panel {
    min-height: 300px;
    border-radius: 16px;
    padding-block: clamp(18px, 3vw, 32px);
  }

  .hero-scene::after {
    background:
      radial-gradient(520px 360px at 24% 22%, hsl(200 80% 96% / .92), transparent 58%),
      linear-gradient(135deg, hsl(205 70% 97% / .92), hsl(200 60% 98% / .92));
  }
}
